# 다형성과 추상 타입

## 다형성

다형성은 두가지를 만족해야 한다(https://www.bsidesoft.com/2339)
- 대체가능성(substitution) – 어떤 형을 요구한다면 그 형의 자식형으로 그 자리를 대신할 수 있다.
- 내적동질성(internal identity) – 객체는 그 객체를 참조하는 방식에 따라 변화하지 않는다. 즉 업다운캐스팅해도 여전히 최조 생성한 그 객체라는 것입니다.

루비나 스칼라는 믹스인을 통해 다형성을 제공할 수 있다. 이 외에 자바스크립트, 그루비 등의 동적 타입 언어는 정적 타입 언어와 달리 명시적으로 타입을 지정하지 않아도 **타입에서 요구하는 오퍼레이션을 제공할 수 있기 때문에**, 이들 언어는 타입을 상속받는 방법을 사용하지 않더라도 다형성을 구현할 수 있다.

### 구상 클래스라는 용어
저자가 책에서 밝힌 글([구상 클래스란 용어의 어색함](https://javacan.tistory.com/253))에서는  
구상이라는 용어가 추상에 반대되는 의미로 사용되기 때문에, 추상 인터페이스를 상속받지 않는 클래스를 구상클래스라고 명명하는 것이 어색하다고 했다.
구상이라는 용어의 사전적 의미는 "사물이 직접 경험하거나 지각할 수 있도록 일정한 모습을 갖추고 있음"이기 때문에 옳은 표현이다.

## 책 내용 정리

### 3.2 추상 타입을 이용한 구현 교체의 유연함

76p.

FlowController에서는 두 번의 추상화가 진행됐다.
- 바이트 데이터를 읽기 : ByteSource 인터페이스 도출
- ByteSource 객체를 생성하기 : ByteSourceFactory 도출

객체를 생성하는 책임과 흐름을 제어하는 책임이 한 곳에 섞여 있었고 객체 생성 책임을 ByteSourceFactory로 분리할 수 있었다.
추상화는 공통된 개념을 도출해서 추상 타입을 정의해 주기도 하지만, 또한 많은 책임을 가진 객체로부터 책임을 분리하는 촉매제가 되기도 한다.

77p. 재사용
FileDataReader나 SocketDataReader는 데이터를 어떻게 읽어 오는지에 대한 상세한 구현을 다루고 있으며, 이들은 파일이나 소켓이라는 특정한 구현을 재사용하는 용도로 사용된다. 반면에 FlowController는 데이터를 읽고 암호화하고 데이터를 쓰는 핵심 로직을 제공하고 있다. 여기서 FlowController는 상대적으로 상위 수준의 로직을 제공하며 FileDataReader는 파일에서 읽기라는 하위 수준의 구현을 제공한다.

암호화 알고리즘이 바뀌거나 데이터를 읽고 쓰는 대상이 바뀌더라도 FlowController가 제공하는 상위 수준의 로직은 바뀌지 않고 재사용되므로, 재사용의 중요성으로 봤을 때 **하위 수준의 상세 구현보다는 변하지 않는 상위 수준의 로직을 재사용할 수 있도록 설계하는 것이 중요**하다.

### 3.3 변화되는 부분을 추상화하기

변화하는 부분을 추상화할 것
- 요구 사항이 바뀔 때 변화되는 부분은 이후에도 변경될 소지가 많다.

### 3.4 인터페이스에 대고 프로그래밍하기

인터페이스는 최초 설계에서 바로 도출되기 보다는 요구 사항의 변화와 함께 점진적으로 도출이 된다. 즉, 인터페이스는 **새롭게 발견된** 추상 개념을 통해서 도출되는 것이다.

추상 타입을 사용하면 기존 코드를 건드리지 않으면서 콘크리트 클래스를 교체할 수 있는 유연함을 얻을 수 있었는데, '인터페이스에 대고 프로그래밍하기' 규칙은 바로 추상화를 통한 유연함을 얻기 위한 규칙이다.

유연함을 얻는 과정에서 타입(추상 타입)이 증가하고 구조도 복잡해지기 때문에 모든 곳에서 인터페이스를 사용해서는 안 된다는 것이다. 인터페이스는 변화 가능성이 높은 경우에 한해서 사용해야 한다.

### 3.5 인터페이스는 인터페이스 사용자 입장에서 만들기

그렇다.

### 3.6 

Stub vs Mock?
- http://egloos.zum.com/kingori/v/4169398
    - Martin Fowler의 글 Mocks Aren't Stubs
        - "Stub 은 테스트 과정에서 일어나는 호출에 대해 지정된 답변을 제공하고, 그 밖의 테스트를 위해 별도로 프로그래밍 되지 않은 질의에 대해서는 대게 아무런 대응을 하지 않는다. 또한 Stub은 email gateway stub 이 '보낸' 메시지를 기억하거나, '보낸' 메일 개수를 저장하는 것과 같이, 호출된 내용에 대한 정보를 기록할 수 있다."
        - "Mock은 Mock 객체가 수신할 것으로 예상되는 호출들을 예측하여 미리 프로그래밍한 객체이다."























