# 04 상태(State) 패턴

## 상태(State) 패턴의 구성

- context : 상태를 가짐
- 상태 객체 : context의 상태에 따라 기능을 수행할 객체

## context의 상태 변경은 누가?

콘텍스트에서 변경하는 방식
- 비교적 상태 개수가 적고 상태 변경 규칙이 거의 바뀌지 않는 경우에 유리
  - 상태 종류가 지속적으로 변경되거나 상태 변경 규칙이 자주 바뀔 경우 콘텍스트의 상태 변경 처리 코드가 복잡해질 가능성이 높음
  - 상태 변경 처리 코드가 복잡해질수록 상태 변경의 유연함이 떨어진다
  
상태 객체에서 콘텍스트의 상태를 변경할 경우
- 콘텍스트에 영향을 주지 않으면서 상태를 추가하거나 상태 변경 규칙을 바꿀 수 있게 된다
- 상태 변경 규칙이 여러 클래스에 분산되어 있기 때문에, 상태 구현 클래스가 많아질수록 상태 변경 규칙을 파악하기 어려워지는 단점
- 한 상태 클래스에서 다른 상태 클래스에 대한 의존도 발생

## TDD 후기

- 지루함
- State interface를 구현한 클래스에서 getStateType()은 공통으로 사용하고 로직이 변경될 리 없음
  - State를 abstract 클래스로 변경하는 건 괜찮을 것 같음. 그런데 state를 하위 클래스에서 재선언 할 수 없어서 실패(자바 문법을 모른 탓 같음)
  - getStateType()만 abstract 클래스로 변경하려니 VendingMachine 클래스가 state 객체 getStateType()과 인터페이스의 메소드 모두 사용하고 있어서 안 됨
  - 결국 getStateType()을 interface에 넣은 것이 문제로 보이고, 이걸 추가로 만든 목적은 테스트에서의 비교 때문인 것 같은데, 더 좋은 방법을 모르겠음
- -> 스터디 시간에 interface에 default를 선언하면 되는 것으로 들었음
